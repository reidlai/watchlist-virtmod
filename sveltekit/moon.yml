$schema: "https://moonrepo.dev/schemas/project.json"
id: "watchlist-sveltekit"
type: "library"
stack: "frontend"

tasks:
  build:
    command: "svelte-package"
    outputs:
      - "dist/**"
    options:
      mergeArgs: "replace"

  dev:
    command: "vite dev"
    local: true

  storybook:
    command: "pnpm run story:dev"
    local: true
  sync:
    command: "svelte-kit sync"

  check:
    command: "svelte-check --tsconfig ./tsconfig.json"
    deps:
      - "sync"

  lint:
    command: "svelte-check --tsconfig ./tsconfig.json --output human"
    inputs:
      [
        "src/**/*",
        "!src/lib/api-client.ts",
        "!dist/**",
        "!storybook-static/**",
        "**/.*/**",
        "moon.yml",
      ]
    options:
      mergeArgs: "replace"
      mergeInputs: "replace"
    deps:
      - "sync"

  test:
    command: "vitest run"
    platform: node
    options:
      mergeArgs: "replace"

  format:
    command: "prettier --write --ignore-path ../../../.prettierignore ."
    inputs:
      [
        "**/*",
        "!node_modules/**",
        "!dist/**",
        "!storybook-static/**",
        "**/.*/**",
      ]
    platform: node
    options:
      mergeArgs: "replace"
