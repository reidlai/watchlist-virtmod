# https://moonrepo.dev/docs/config/project
id: 'watchlist'
language: "unknown" # Mixed/Polyglot

fileGroups:
  go: ["go/**/*"]
  sveltekit: ["sveltekit/**/*", "!sveltekit/node_modules/**", "!sveltekit/dist/**", "**/.*/**"]

tasks:
  # Go Backend
  go-build:
    command: "go build -v ./go/..."
    inputs: ["go/**/*"]
    platform: "system"

  go-test:
    command: "go test -v ./go/..."
    inputs: ["go/**/*", "!go/goa_gen/**"]
    platform: "system"

  go-lint:
    deps: ["watchlist-go:lint"]
    platform: "system"
    options:
      mergeInputs: "replace"

  go-format:
    command: "goimports -w ./go"
    inputs: ["go/**/*"]
    options:
      mergeArgs: "replace"
      mergeInputs: "replace"

  # Svelte Frontend
  sveltekit-dev:
    deps: ["watchlist-sveltekit:dev"]
    local: true
    platform: "node"

  sveltekit-build:
    deps: ["watchlist-sveltekit:build"]
    platform: "node"

  sveltekit-sync:
    deps: ["watchlist-sveltekit:sync"]
    platform: "node"
    local: true
    options:
      runInCI: true
      persistent: false

  sveltekit-check:
    deps: ["watchlist-sveltekit:check"]
    platform: "node"

  sveltekit-test:
    deps: ["watchlist-sveltekit:test"]
    platform: "node"

  sveltekit-lint:
    deps: ["watchlist-sveltekit:lint"]
    platform: "system"
    options:
      mergeInputs: 'replace'

  sveltekit-format:
    deps: ["watchlist-sveltekit:format"]
    platform: "system"
    inputs: ["moon.yml"]
    options:
      mergeInputs: 'replace'

  # Composite Tasks
  build:
    command: 'echo "Building all components"'
    deps: ["go-build", "sveltekit-build"]
    outputs: []
    platform: "system"
    options:
      mergeArgs: 'replace'
      mergeInputs: 'replace'
      mergeOutputs: 'replace'

  test:
    command: 'echo "Testing all components"'
    deps: ["go-test", "sveltekit-test", "sveltekit-check"]
    platform: "system"
    options:
      mergeArgs: 'replace'

  lint:
    command: 'echo "Linting all components"'
    deps: ["go-lint", "sveltekit-lint"]
    platform: "system"
    inputs: ["moon.yml"]
    options:
      mergeArgs: 'replace'
      mergeInputs: 'replace'

  format:
    command: 'echo "Formatting all components"'
    deps: ["go-format", "sveltekit-format"]
    platform: "system"
    inputs: ["moon.yml"]
    options:
      mergeArgs: 'replace'
      mergeInputs: 'replace'

